const fs = require('fs');
const path = require('path');

const { format } = require('@hint/utils/dist/src/i18n/format');

const filename = path.join(process.cwd(), 'src', 'assets', 'js', 'scan', 'get-message.js');

const content = `// Autogenerated by scripts/create-get-message.js

(function () {

    /* eslint-disable padding-line-between-statements */
    const format = ${format.toString().split('\n')
        .map((line, index) => {
            if (index === 0) {
                return line;
            }

            return `    ${line}`;
        })
        .join('\n')};
    /* eslint-enable padding-line-between-statements */

    window.getMessage = (key, substitutions) => {
        const localeString = window.localeStrings && window.localeStrings[key];

        if (!localeString) {
            return key;
        }

        return format(localeString.message, substitutions);
    };
}());
`;


fs.writeFile(filename, content, (err) => {
    if (err) {
        throw err;
    } else {
        console.log(`Created: ${filename} `);
    }
});
