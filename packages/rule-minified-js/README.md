# minified-js (`@sonarwhal/rule-minified-js`)

This rule checks whether JavaScript used by your web page is minified or not.

## Why is this important?

Minifying your JavaScript is a great way to improve your page load time.
This includes removing unused variables and methods, renaming variables
 and methods to smaller names, removing code comments, etc.
Minification should generate a smaller file, and thus less code to parse.

## How to use this rule?

To use it you will have to install it via `npm`:

```bash
npm install @sonarwhal/rule-minified-js
```

Note: You can make `npm` install it as a `devDependency` using the `--save-dev`
parameter, or to install it globally, you can use the `-g` parameter. For
other options see
[`npm`'s documentation][NPM documentation].

And then activate it via the [`.sonarwhalrc`][sonarwhalrc]
configuration file:

```json
{
    "connector": {...},
    "formatters": [...],
    "parsers": ["javascript"],
    "rules": {
        "js-minify-check": "error"
    },
    ...
}
```

## What does the rule check?

This rule generates an *"Improvement Index"* value for the script content
and compare it against a derived threshold value to determine whether the
content is minified or not.

Improvement index is generated by comparing the number of tokens
(from the abstract syntax tree generated from the code) with the
total content length of a file.

```javascript
const tokenRatio = tokenLength / contentLength;
const improvementIndex = Math.round((1 - tokenRatio) * 100);

if (improvementIndex > threshold) {
    // Script might be unminified
}
```

By default, the rule uses **75** as the threshold value to compare against.
If the calculated improvement index value is greater than the threshold,
the script will be flagged as unminified.

 *The value 75 was derived after running tests on some of the mostly used
 libraries and a couple of custom JavaScript files.* See the
 [sample repo][Improvement Index tests repo] with the test files and results.

## Can the rule be configured?

By default, the rule uses `75` as the threshold value. But you can override
that with a custom value in your [`.sonarwhalrc`][sonarwhalrc] config

```json
{
    "connector": {...},
    "formatters": [...],
    "parsers": ["javascript"],
    "rules": {
        "js-minify-check": ["error", {
            "threshold": 80
        }]
    },
    ...
}
```

## Further Reading

Here are some useful topics if you are new to minification

* [Minification][Minification Wiki]

* [Minify Resources (HTML, CSS, and JavaScript)][Google Speed Insights]

<!-- Link labels: -->

[sonarwhalrc]:
https://sonarwhal.com/docs/user-guide/further-configuration/sonarwhalrc-formats/

[Improvement Index tests repo]:
https://github.com/kshyju/ImprovementIndex-Comparison

[Minification Wiki]:
https://en.wikipedia.org/wiki/Minification_(programming)

[Google Speed Insights]:
https://developers.google.com/speed/docs/insights/MinifyResources

[NPM documentation]:
[https://docs.npmjs.com/cli/install]

[sonarwhalrc]:
https://sonarwhal.com/docs/user-guide/further-configuration/sonarwhalrc-formats/

<!-- Link labels: -->